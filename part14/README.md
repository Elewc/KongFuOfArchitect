## 第十四部分 案例

实现目标

桌面客户端 简单工具箱

### pyqt5 篇

#### 基础布局

- [hello](./src/hello.py)
- [hello-oop](./src/hello.py)
- [水平布局](./src/h_layout.py)
- [垂直布局](./src/v_layout.py)
- [宫格布局](./src/g_layout.py)
- [表单布局](./src/f_layout.py)

#### 弹框

- [基本弹框](src/dialog.py)

#### 创建主弹框

- [一个主窗口](src/main_window.py)

> 注意：当您以自己的方法实现不同的 GUI 组件时，您正在使代码更具可读性和可维护性。但是，这不是一个要求，因此您可以自由地以您最喜欢的方式组织代码。
> 

到目前为止，您已经领略了 PyQt5 系列小部件中一些更重要的图形组件。在接下来的两个部分中，您将领略与 PyQt GUI 应用程序相关的其他重要概念。


#### Applications


在 `PyQt` 中，任何 `QT` 例都被视为 `application`。每个 `PyQt GUI` 应用程序必须有一个 `QApplication` 对象。申请的一些职责包括：

- 初始化
- 事件轮询和事件处理
- 系统维度和应用维度的设置
- 系统全局信息，例如应用目录、窗口尺寸、等等
- 转换一般的命令行参数
- 定义应用的外观
- 提供本地化能力

##### 事件轮询

GUI 应用程序由事件驱动。这意味着，功能和方法是响应用户操作执行的，如单击按钮、从组合框中选择项目、在文本编辑中输入或更新文本、按键盘上的键等。这些用户操作通常称为事件。

事件通常由事件循环（也称为主循环）处理。事件循环是一个无限循环，其中处理和发送来自用户、窗口系统和任何其他源的所有事件。事件循环等待事件发生，然后调度它执行某些任务。事件循环继续工作，直到应用程序终止。

所有 GUI 应用程序都使用事件循环。事件循环是一种等待事件发生的无限循环。如果发生事件，则循环检查事件是否是终止事件。在这种情况下，循环被终止，应用程序退出。否则，事件将发送到应用程序的事件队列以进行进一步处理，循环将重新开始。

> PyQt 最初开发为针对 Python 2 的目标， 它已经有一个`exec`关键字。在早期版本中，在`.exec_`末尾添加了一个下划线，以帮助避免名称冲突。Pyqt5 的目标是 Python 3， 它没有`exec`关键字。尽管如此，库还是提供了启动事件循环的两种方法：
> 

1. exec_()
2. exec()

要触发响应操作，则需要将事件与要执行的操作连接起来。在 PyQt5 中，您可以使用信号和插槽机制建立该连接。您将在下一节中涵盖这些内容。

#### 信号和插槽

PyQt 小部件充当活动捕捉者。这意味着每个小部件都能捕捉到特定数量的事件，如鼠标点击、按键等。为了响应这些事件，小部件总是发出信号，这是一种宣布其状态变化的信息。信号本身不执行任何操作。

如果您想要触发操作的信号，则需要将其连接到插槽。这是每当发出连接信号时执行操作的功能或方法。您可以使用任何 Python `callable` （或`回调`） 作为插槽。

如果信号连接到插槽，则每当发出信号时，都会调用插槽。如果信号未连接到任何插槽，则不会发生任何事件，并且会忽略信号。以下是此机制的一些最有用的功能：

- 一个信号可以连接到一个或多个插槽。
- 一个信号也可能连接到另一个信号。
- 一个插槽可能连接到一个或多个信号。

您可以使用以下语法将信号连接到插槽：

```python
widget.signal.connect(slot_function)
```

这将slot_function连接到小部件的信号。每当发出信号时，都会调用`slot_function()`。此代码向您展示如何使用信号和插槽机制：

[插槽与信号](src/signals_slots.py)

注意：每个小部件都有自己的一组预定义信号。您可以在小部件的文档页面上查看它们。

如果您的插槽功能需要接收额外的参数，则您可以使用 `functools.partial`传递它们。例如，您可以修改问候如下：

```python
def greeting(who):
    """Slot function."""
    if msg.text():
        msg.setText('')
    else:
        msg.setText(f'Hello {who}')
```

此时，你可以自定义参数

```python
btn.clicked.connect(functools.partial(greeting, 'World!'))
```

要使此代码工作，您需要首先导入 `functools`。调用 `functools.partial()`返回一个对象， 其行为类似于与`greeting() with who='World!'.`，当用户单击按钮时，"Hello World！" 消息将像以前一样显示在标签中。


现在，您已经完成了对 PyQt5 最重要的概念的理解。有了这些知识和库的文档，您就可以开始开发自己的 `GUI` 应用程序。~~在下一节中~~，您将构建您的第一个功能齐全的 `GUI` 应用程序。